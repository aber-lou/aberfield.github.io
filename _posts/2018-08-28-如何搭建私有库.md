---
layout: mypost
title: iOS开发搭建私有库
---

### iOS第三方库管理工具

+ iOS开发第三方库的管理基本上两个: CocoaPod & Carthage，当然CocoaPod更为大众一点，但是CocoaPod也是有一定弊端的，比如侵入太强，会改变工程结构和配置。而Carthage更为轻量，不会对工程做任何更改，没有CocoaPod那样的侵入性，主要的工作原理是根据CartFile描述文件获取第三方框架的网络地址并下载，通过Xcode编译成FrameWork动态库。相比于CocoaPod的优点:

    1. 去中心化
    2. 无侵入性
    3. 可以和CocoaPod共存
    4. 第三方库预先编译过了，项目编译时不会重复编译
   
+ 当然也有缺点:
    
    1. 使用的动态库，只支持iOS8+
    2. 现在很多框架并不支持Carthage
    3. 项目中如果第三方库报错崩溃无法定位到问题点
    4. 安装包会比CocoaPod大一点
    5. 无法在项目中查阅第三方库源码
   
### 关于Carthage的使用

+ Carthage安装：
  
    ```
        $ brew install carthage
    ```

+ 在需要增加Carthage管理的项目中 新建Carfile文件，文件引入第三方格式如:
    
    ```
        github "Alamofire/Alamofire" ~> 4.7.2v
    ```

+ 再更新项目依赖和文件:
  
    ```
        $ carthage upadate
    ```

+ update 之后，在项目工程中就会多出一些对应第三方库的动态库:
  
  ![Carthage](https://raw.githubusercontent.com/aberfield/aberfield.github.io/master/posts/carthage.jpg)


+ 在Target-> General -> Link Library with Libraries 中选择other，到项目工程Build文件中选对对应平台的FrameWork导入到工程中，然后在Target->Build Phases -> " + " -> New Run Script Phases 新增新的脚本，如下:
    
    1. 在shell下面输入：/usr/local/bin/Carthage copy-frameworks
    2. 在Input Files中加入：$(SRCROOT)/Carthage/Build/Mac/Alamofire.framework
    3. 在Output Files中加入：$(DERIVED_FILE_DIR)/$(FRAMEWORKS_FOLDER_PATH)/Alamofire.framework

+ 项目运行之后即可使用Alamofire框架

### 如何使用CocoaPod搭建私有库

+ 为什么需要使用CocoaPod搭建私有库
   
   1. 代码抽离，将底层模块工具等抽离出来，方便多个项目统一使用
   2. 需要更改第三方Pod库源码，协作时Pod Install 可能会忘记修改代码

+ 如何搭建CocoaPod私有库

    1. 先在GitHub、GitLib等托管平台建立好一个空的仓库,用来放Spec Repe,如图所示:

        ![Carthage](https://raw.githubusercontent.com/aberfield/aberfield.github.io/master/posts/spec.png)

    2. 可以通过命令```pod repo AberPods add https://github.com/aberfield/AberPods.git ```，它将会被Clone到本地的~/.cocoapods/repos 目录下，如下:

        ![Carthage](https://raw.githubusercontent.com/aberfield/aberfield.github.io/master/posts/podSpec.png)

    3. 然后在你想要创建第三方库的文件夹中执行命令:

        ```
            $ pod lib create AberToolExtension
        ```
        按照指示内容选择相关选项，这一步执行之后会生成相关项目工程，里面包括你需要用到的Demo文件以及Pod第三方库需要替换的文件(打开文件之后可以在Pod->Classess文件中找到ReplaceMe文件，把你需要引入的Pod库文件导入其中即可)

    4. 创建Git第三方库工具库，并将本地项目添加到远程仓库中，可以通过命令行或者SourceTree，Git的相关操作就不赘述了，主要是注意先Pull在Push。

    5. 添加相关仓库，并将需要替换的文件替换到ReplaceMe文件之后，修改，修改AberToolExtension.podspec文件中的```s.version```为 ```0.0.1```后提交代码，并且增加增加Git Tag标签为0.0.1

    6. 执行 ```pod lib lint ```命令查看是否Pod制作成功

    7. 提交podspec，命令如下
        ```
            pod repo push AberPods AberExtensionTool.podspec
        ```
        这样我们就可以在```~/.cocoapod/spec/AberPod```文件中看到提交的AberExtensionTool.podspec文件了
    

    8. 在项目工程的Podfile文件的Pod 源引入新制作的Pod仓库的源地址，Podfile文件如下:
   
        ```
        source 'https://github.com/CocoaPods/Specs.git'
        source 'https://github.com/aberfield/AberPods.git'

        platform :ios, '9.0'
        use_frameworks!

        ```
   
    到这一步，私有库基本上就可以使用了。


    关于遇到的坑： pod lib lint 很难通过，发现时我的s.source.file文件没有对应好，后面实在没办法直接把Classes文件删了，修改了s.source.file路径就可以了。


   













