---
layout: mypost
title: 青石证券-iOS客户端
---

# 项目相关介绍
    
+  青石证券移动端项目迭代到现在涉及到的业务有证券，基金，保险，证券这边包括证券行情，证券资讯，证券交易等业务。相比之下基金和保险模块功能相对会少一些。截止至今，快速迭代版本是3.8.8。下面主要针对iOS端App进行三个方面的介绍。

# 业务模块

### 股票行情

+ 股票行情包括股票自选内容，自选编辑，自选指数大盘，股票市场（美股，港股）， 精选ETF内容，股票IPO，个股页面，股票订阅提醒，股票搜索页
+ 股票市场又分为，港股，美股，港股中包含行业概念、热门ETF、认股证成交榜，认股证涨跌幅榜，牛熊证涨跌幅、成交额榜，主板涨跌幅榜，创业榜涨跌幅榜，红蓝筹涨跌幅榜，港股通涨跌幅榜。美股中包含行业概念，热门ETF，中概股涨跌幅榜，明星股涨跌幅榜，纽交所涨跌幅榜，纳斯达克涨跌幅榜，美交所涨跌幅榜
+ 个股页面主要包括股票详情，是否延时，是否支持融资等标志。同时包括分时，五日，日K，周K，月K走势图，买卖盘，逐笔。页面还需根据用户行情状态进行显示不同类型功能。

### 基金

+ 基金理财，主要包括基金首页，试算页，详情页，持仓订单，申购赎回等页面

### 交易中心

+ 股票交易：证券相关市值，购买力，负债抵押，个人股票持仓，挂单，已成交，已撤单
+ 基金交易：基金相关市值，最新收益，累计收益，基金持仓，基金交易历史


### 资讯，消息模块

+ 资讯包含财经头条、7x24小时资讯直播
+ 消息模块：一般的热点消息，股票资讯消息，订阅消息，交易消息等

### 我的模块

+ 用户个人信息，切换账号，用户资产，与用户绑定的相关资产，保险服务，日月结单，活动，以及基金风险测评
+ 页面内容，包括主题色切换，设置
+ 设置中心包括安全设置，显示设置，清除缓存，退出登录


+ 业务功能相关模块可以参考下图：
  ![功能图](http://git.bluestonehk.com/iOS/Arkenstone/raw/feature/3.8.8/main/Docs/%E9%9D%92%E7%9F%B3%E8%AF%81%E5%88%B8%20(1).png)


# 业务功能

### 股票行情，交易
+ 股票行情：移动端港股行情需参加活动或者购买才能拥有实时行情。美股实时行情只对领取用户展示，领取逻辑，领取之后，下月登录自动领取，隔月登录需手动领取。有实时行情用户才能有行情推送内容。
+ 行情推送：在市场盘中阶段，主动推送行情报价信息，包括自选模块，自选大盘，行情主页，个股详情页(股价信息，逐笔，分时)。自选，自选大盘，个股详情页数据变更有相应动画。
+ 自选排序：智能排序，股价，涨跌幅排序。可以根据升序降序进行排序。

+ 股价变动提醒：从价格，涨跌幅两个维度订阅股票内容，满足条件推送消息通知用户股票涨跌变更
+ 股票交易：可对港美股进行买卖操作，支持订单为普通订单，竞价单，竞价限价单。可对挂单股票进行改单，撤单操作。
+ IPO申购：查看港股最新IPO股票，快捷申购，修改，查看IPO信息，跟踪申购状态。
+ 查看用户资产：包含资金，证券市值，持仓，订单信息，负债，购买力
+ 换汇：应用内支持港股，美股，人民币换汇操作
+ 股票相关业务：提升融资额度，行情权限，转股，日结单，月结单，股票流水，资金流水

### 账户体系

+ 青石证券账户：在青石官网或App上注册的青石账号，可以通过登录，第三方登录，查看以及修改用户信息。
+ 证券账户：App内可以进行线上开户，提交申请，业务人员审核，审核通过开通恒生账号，自动与青石证券账号绑定
+ 恒生账号：股票交易是走的恒生柜台，一般开通恒生账号之后会有现金账号和融资账号，融资账号根据股票质押会有一定额度的借款能力。

### 其他业务支撑

+ 运营位配置：启动页广告，首页弹窗广告，部分页面广告位配置，提示语，以及Banner滚动广告
+ 消息管理：包括系统消息，估计提醒消息，证券交易消息
+ 设置：换肤，版本更新内容，安全设置，红涨绿跌设置
+ 基金：申购赎回，查看基金
+ 保险：查看与用户关联绑定的保险信息
+ 阿波罗配置：基础配置可以通过阿波罗接口拉取，同时建议今后初始化配置走阿波罗配置

# 项目结构

- BSTrade
    - BSTrade                   [主工程]
        - BridgeHeader          [ObjC转Swift的桥接文件，在此文件中导入头文件即可] 
        - AppDelegate           [应用程序代理，启动初始化事项]
        - Classes               [工程主模块文件夹]
            - Modules           [通知、Apollo配置、Web页面自定义配置、弹窗广告、全局截屏、路由等全局处理类]
            - BusinessModule    [按业务分成不同的模块，模块下分管ViewControll、ViewModel、View]
                - StockContentModule        [股票相关内容，如还款指引，股价提醒，行情父视图，换汇，资金流水，股票流水]
                - SettingModule             [设置相关模块，如配置页，显示设置，更换颜色]
                - UnitStockModule           [个股相关视图，港美股，指数，行业概念，涡轮权证]
                - US&HKMarketModule         [港股美股市场，更多股票，股票权证等]
                - Base&UtilsModule          [视图基类，启动引导页，搜索页，全局Web页面，分享，警告视图，TabBar，NavigationBar基类]
                - Fund&PositionModule       [基金，基金持仓模块，基金首页，详情页，申购赎回页，基金交易页，详细持仓页]
                - FollowedStockModule       [股票自选页面]
                - HomeMarketQuotaeModule    [股票自选TabBar下的自选分时图，自选价格视图]
                - NewsModule                [新闻资讯模块，7-24小时，新闻详情页]
                - UserManagerModule         [用户相关模块，我的页面，用户登录，修改交易密码，二次验证，多账户管理]
                - IPOModule                 [IPO相关模块，IPO首页列表，详情页，IPO申购页，历史IPO页面]
                - ETFModule                 [ETF相关模块，ETF列表页，ETF详情页]
                - TradeModule               [交易模块，交易中心页面，交易历史，交易页，订单修改页面]
                - StockManageModule         [自选股票管理页面，股票分组管理，组内股票管理]
                - MessageModule             [消息管理，消息列表页，订阅消息页，股票交易消息页面]
            - ThirdPart         [手动方式导入的第三方库TalkingData、MonkeyKing等]
            - Business          [业务处理模块，股票行情Socket、交易业务、账号管理、自选分组]
            - Model             [数据模型]
            - Network           [网络接口层、生层请求API，网络连接监听]
            - Tools             [常用的分类扩展]
            - Utils             [日志输出。加密处理、配置化等]
        - Resources             [资源文件夹（主题色），通知音频，字体库，图片资源，App配置内容]
            - Assets            [资源文件（整个项目所使用图片资源，AppIcon LaunchImage）]
            - config.h          [配置项]
            - config.json       [debug和release的网络环境配置文件]
        - Supporting Files      [本地化文件、Info.plist、mian.m]
        - BSTradeTests          [单元测试文件]
        - BSTradeUITests        [UI测试文件]
        - Pods                  [pods文件]
        - Frameworks            [动态库]

    - Pods 第三方库

+ 整体项目结构迭代信息可以查看[青石证券Wiki](http://git.bluestonehk.com/iOS/Arkenstone)页面。

# 技术框架

### 青石证券iOS客户端开发须知：

+ 整体采用Swift和OC混编，OC算是历史包袱，后续功能基本由Swift实现。
+ 第三方库管理采用的是CocoaPods，有些库需要注明依赖源，具体查看PodFile文件。三方库中DKNight和MJRefresh两个库有修改过相关源码，所以引入了私有库管理，具体查看[BSPod](http://git.bluestonehk.com/iOS/BSTPod),开通git权限时需注意。
+ 整体模块设计采用的是MVVM，有些页面历史包袱太重，逻辑解耦并不是特别的完美，需注意。
+ 项目界面UI开发大部分采用的是IB，同时每个模块各自对应着Storyboard，代码约束采用的SnapKit进行约束布局
+ App网络结构是基于YTKNetwork的二次封装，具体内容可以查看BSTAPI文件。model使用的是YYModel进行解析，3.5.0后建议使用Swift 4.0的 Codable进行Model解析
+ 项目使用CocoaAsyncSocket进行TCP连接，读写数据流，用户股票数据的订阅消息推送
+ 项目主体色采用的是DKNight实现深浅主体切换
+ 图片下载缓存采用的是KingFisher
+ APP生成环境的奔溃报告，bug，错误信息收集采用Bugly
+ 页面数据采集埋点采用的是TalkingData，并且使用手动埋点策略
+ App分享采用MonkeyKing，无其他静态库，依赖包
+ 项目开启了BitCode优化，Bugly中DSYM需从iTune Connects活动中手动下载上传


### 环境配置，切换，运行，部署，发布

+ 具体环境分为测试、生产，具体文件见```config.json```，新增开发环境配置可以增加内容到patch部分。项目编译时环境脚本查看项目目录下script文件，和Build Phases-> Update Configuration。
+ 项目采用Pods，打开工程请选择xcworkspace
+ 项目使用Fastlane自动构建打包发布，请查看fastlane文件,持续集成采用的是Jenkins，后续Jenkins被弃用，如需使用请自行配置。
+ 项目发布流程规范请查看:[发布规范](http://wiki.bluestonehk.com:8090/pages/viewpage.action?pageId=721972)

# iOS相关文档整理
1. [App需求](http://wiki.bluestonehk.com:8090/pages/viewpage.action?pageId=722871)
2. [App数字格式化规则](http://wiki.bluestonehk.com:8090/pages/viewpage.action?pageId=2032446)
3. [App页面统计规则](http://wiki.bluestonehk.com:8090/pages/viewpage.action?pageId=723734)
4. [App统计方案选型](http://wiki.bluestonehk.com:8090/pages/viewpage.action?pageId=721872)
5. [客户端通用跳转](http://wiki.bluestonehk.com:8090/pages/viewpage.action?pageId=2588692)
6. [App与H5页面交互规则](http://wiki.bluestonehk.com:8090/pages/viewpage.action?pageId=722417)
7. [App基金试算页面交互规则](http://wiki.bluestonehk.com:8090/pages/viewpage.action?pageId=2591070)
8. [iOS客户端通用跳转设计方案](http://120.24.44.61:8090/pages/viewpage.action?pageId=2588692)
9. [青石 iOS 客户端代码管理规范](http://docs.bluestonehk.com/arkenstone/git.html)
10. [App与H5页面登录态同步问题](https://www.evernote.com/shard/s123/sh/a169ea4a-e4a1-47fd-93d2-e95aaf7c11bd/ab4d2dfd5085f21331bd96c0fb90122a%EF%BC%89)
11. [版本更新迭代，以及功能说明](http://git.bluestonehk.com/iOS/Arkenstone)
12. [项目文档](http://docs.bluestonehk.com/arkenstone/)


